const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UnitsTable-DRMpi2L9.js","assets/index-ChuUIRBG.js","assets/vendor-C5zIUBfc.js","assets/ui-DPhHsU_z.js","assets/index-BUIivcom.css","assets/TrashIcon-CqYIIe7G.js","assets/UnitCard-C05d7ARk.js","assets/UnitModal-Ba5EOyxI.js","assets/Stepper-B5s6UTpD.js","assets/react-paginate-dLrqzcou.js","assets/BuildingOffice2Icon-D-1YPzJO.js","assets/DataTable-Btpq34tD.js","assets/ImageUploader-piXC7qzV.js","assets/ImageUploader-BD8MpcyB.css","assets/ExclamationTriangleIcon-DXl3jWQD.js","assets/EditUnitModal-CLqKFMES.js","assets/DeleteUnitModal-RZPdEUsf.js"])))=>i.map(i=>d[i]);
import{b as s,_}from"./vendor-C5zIUBfc.js";import{j as e,z as G,L as X,e as z,q as Z,f as J,s as S,g as R}from"./index-ChuUIRBG.js";import{u as V}from"./react-paginate-dLrqzcou.js";import{P as K,S as Y,D as ee}from"./DataTable-Btpq34tD.js";import{I as se,v as te}from"./ImageUploader-piXC7qzV.js";import{F as ae}from"./ExclamationTriangleIcon-DXl3jWQD.js";function le({title:r,titleId:a,...i},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}const $=s.forwardRef(le);function re({title:r,titleId:a,...i},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"}))}const ne=s.forwardRef(re);function ie({title:r,titleId:a,...i},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const oe=s.forwardRef(ie);function de({title:r,titleId:a,...i},t){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),r?s.createElement("title",{id:a},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const ce=s.forwardRef(de),me=()=>{const{data:r,isLoading:a,error:i,mutate:t}=V({tableName:"units",selectQuery:"id, name, type",searchColumn:"name",initialPageSize:1e3});return{units:r,isLoading:a,error:i,mutateUnits:t}},xe=({currentStep:r,steps:a})=>e.jsx("nav",{"aria-label":"Progress",className:"p-6 border-b border-neutral-200",children:e.jsx("ol",{role:"list",className:"space-y-4 md:flex md:space-x-8 md:space-y-0",children:a.map((i,t)=>e.jsx("li",{className:"md:flex-1",children:r>t+1?e.jsxs("div",{className:"group flex w-full flex-col border-l-4 border-orange-600 py-2 pl-4 transition-colors md:border-l-0 md:border-t-4 md:pb-0 md:pl-0 md:pt-4",children:[e.jsx("span",{className:"text-sm font-medium text-orange-600 transition-colors",children:`Step ${t+1}`}),e.jsx("span",{className:"text-sm font-medium",children:i})]}):r===t+1?e.jsxs("div",{className:"flex w-full flex-col border-l-4 border-orange-600 py-2 pl-4 md:border-l-0 md:border-t-4 md:pb-0 md:pl-0 md:pt-4","aria-current":"step",children:[e.jsx("span",{className:"text-sm font-medium text-orange-600",children:`Step ${t+1}`}),e.jsx("span",{className:"text-sm font-medium",children:i})]}):e.jsxs("div",{className:"group flex w-full flex-col border-l-4 border-gray-200 py-2 pl-4 transition-colors md:border-l-0 md:border-t-4 md:pb-0 md:pl-0 md:pt-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 transition-colors",children:`Step ${t+1}`}),e.jsx("span",{className:"text-sm font-medium",children:i})]})},i))})});function ue({isOpen:r,onClose:a,onSuccess:i}){const[t,p]=s.useState(1),[m,g]=s.useState(""),[x,c]=s.useState([]),[n,d]=s.useState(new Set),[k,F]=s.useState(""),[N,h]=s.useState(!1),[y,j]=s.useState(null),{units:L,isLoading:O,error:A}=me(),E=["Facility Details","Assign to Units"],b=()=>{p(1),g(""),c([]),d(new Set),F(""),h(!1),j(null),a()},P=l=>{d(U=>{const u=new Set(U);return u.has(l)?u.delete(l):u.add(l),u})},f=L.filter(l=>l.name.toLowerCase().includes(k.toLowerCase())),T=()=>{n.size===f.length?d(new Set):d(new Set(f.map(l=>l.id)))},C=async()=>{if(j(null),!(!M||!w)){h(!0);try{const l=x[0].file,u=`public/${`${te()}-${l.name}`}`,{error:o}=await S.storage.from("facility-images").upload(u,l);if(o)throw o;const{data:v}=S.storage.from("facility-images").getPublicUrl(u),B=v.publicUrl,{data:q,error:D}=await S.from("facilities").insert({name:m,image_url:B}).select().single();if(D)throw D;const H=q.id,W=Array.from(n).map(Q=>({facility_id:H,unit_id:Q})),{error:I}=await S.from("facility_units").insert(W);if(I)throw I;i(),b()}catch(l){console.error("Failed to save facility:",l),j(`Error: ${l.message}. Please try again.`)}finally{h(!1)}}},M=m.trim()!==""&&x.length>0,w=n.size>0;return e.jsx(G,{appear:!0,show:r,as:s.Fragment,children:e.jsxs(X,{as:"div",className:"relative z-50 font-sans",onClose:b,children:[e.jsx(z,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/30"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(z,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(Z,{className:"w-full max-w-3xl transform overflow-hidden rounded-2xl bg-white text-left align-middle shadow-2xl transition-all",children:[e.jsxs(J,{as:"h3",className:"flex justify-between items-center p-6 text-2xl font-semibold leading-6 text-neutral-900 border-b border-neutral-200",children:["Add New Facility",e.jsx("button",{onClick:b,className:"p-1 rounded-full text-neutral-400 hover:bg-neutral-100",children:e.jsx(ce,{className:"h-6 w-6"})})]}),e.jsx(xe,{currentStep:t,steps:E}),e.jsxs("div",{className:"p-6 min-h-[450px]",children:[t===1&&e.jsxs("div",{className:"animate-fadeIn space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"facility-name",className:"block text-sm font-medium text-gray-700",children:"Facility Name"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(ne,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})}),e.jsx("input",{type:"text",id:"facility-name",value:m,onChange:l=>g(l.target.value),className:"block w-full rounded-md border-gray-300 pl-10 focus:border-orange-500 focus:ring-orange-500 sm:text-sm",placeholder:"e.g., Swimming Pool"})]})]}),e.jsx(se,{label:"Facility Image",files:x,setFiles:c,maxFiles:1})]}),t===2&&e.jsx("div",{className:"animate-fadeIn space-y-4",children:O?e.jsxs("div",{className:"text-center py-10",children:[e.jsx($,{className:"mx-auto h-8 w-8 text-neutral-400 animate-spin"}),e.jsx("p",{className:"mt-2 text-sm text-neutral-500",children:"Loading Units..."})]}):A?e.jsxs("div",{className:"text-center py-10 text-red-600",children:[e.jsx(ae,{className:"mx-auto h-8 w-8"}),e.jsx("p",{className:"mt-2",children:"Failed to load units."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:k,onChange:l=>F(l.target.value),placeholder:"Search units...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[n.size," of ",f.length," ","selected"]}),e.jsx("button",{onClick:T,className:"text-sm font-medium text-orange-600 hover:text-orange-800",children:n.size===f.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"border rounded-lg max-h-80 overflow-y-auto custom-scrollbar",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:f.map(l=>e.jsxs("li",{className:"p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer",onClick:()=>P(l.id),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:l.name}),e.jsx("p",{className:"text-sm text-gray-500",children:l.type})]}),e.jsx("input",{type:"checkbox",readOnly:!0,checked:n.has(l.id),className:"h-4 w-4 rounded border-gray-300 text-orange-600 focus:ring-orange-500"})]},l.id))})})]})})]}),e.jsxs("div",{className:"p-6 bg-neutral-50 border-t border-neutral-200 space-y-3",children:[y&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:y}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{type:"button",onClick:()=>p(1),className:`px-6 py-2 text-sm font-medium rounded-full shadow-sm border border-neutral-300 hover:bg-neutral-100 ${t===1&&"invisible"}`,children:"Back"}),e.jsx("div",{children:t<E.length?e.jsx("button",{type:"button",onClick:()=>p(2),disabled:!M,className:"px-6 py-2 text-sm font-medium text-white bg-orange-600 rounded-full shadow-lg hover:bg-orange-700 disabled:bg-neutral-400 transition-colors",children:"Next"}):e.jsxs("button",{type:"button",onClick:C,disabled:!w||N,className:"inline-flex items-center px-6 py-2 text-sm font-medium text-white bg-orange-600 rounded-full shadow-lg hover:bg-orange-700 disabled:bg-neutral-400 transition-colors",children:[N&&e.jsx($,{className:"w-4 h-4 mr-2 animate-spin"}),N?"Saving...":"Save Facility"]})})]})]})]})})})})]})})}const pe=()=>e.jsx(e.Fragment,{children:[...Array(3)].map((r,a)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-11 w-11 flex-shrink-0 rounded-full bg-gray-200"}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"h-4 w-32 rounded bg-gray-200"})})]})}),e.jsx("td",{className:"px-3 py-4 text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("div",{className:"h-5 w-20 rounded-md bg-gray-200"}),e.jsx("div",{className:"h-5 w-24 rounded-md bg-gray-200"})]})}),e.jsx("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:e.jsx("div",{className:"h-4 w-8 rounded bg-gray-200"})})]},a))});function he(){const[r,a]=s.useState([]),[i,t]=s.useState(!0),[p,m]=s.useState(null),[g,x]=s.useState(!1),c=s.useCallback(async()=>{t(!0),m(null);try{const{data:n,error:d}=await supabase.from("facilities").select(`
          id,
          name,
          image_url,
          units (
            id,
            name
          )
        `);if(d)throw d;a(n||[])}catch(n){console.error("Error fetching facilities:",n),m("Could not fetch facilities data.")}finally{t(!1)}},[]);return s.useEffect(()=>{c()},[c]),e.jsxs(e.Fragment,{children:[e.jsx(ue,{isOpen:g,onClose:()=>x(!1),onSuccess:c}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 font-sans",children:[e.jsxs("div",{className:"sm:flex sm:items-center",children:[e.jsxs("div",{className:"sm:flex-auto",children:[e.jsx("h1",{className:"text-xl font-semibold leading-6 text-gray-900",children:"Facilities Management"}),e.jsx("p",{className:"mt-2 text-sm text-gray-700",children:"A list of all facilities and the units they are assigned to."})]}),e.jsx("div",{className:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none",children:e.jsx("button",{onClick:()=>x(!0),type:"button",className:"block rounded-md bg-orange-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600",children:"Add Facility"})})]}),e.jsx("div",{className:"mt-8 flow-root",children:e.jsx("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"Facility"}),e.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Assigned Units"}),e.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:e.jsx("span",{className:"sr-only",children:"Edit"})})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:i?e.jsx(pe,{}):p?e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center py-10 text-red-500",children:p})}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center py-10 text-gray-500",children:'No facilities found. Click "Add Facility" to get started.'})}):r.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-11 w-11 flex-shrink-0",children:e.jsx("img",{className:"h-11 w-11 rounded-full object-cover",src:n.image_url,alt:n.name})}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"font-medium text-gray-900",children:n.name})})]})}),e.jsx("td",{className:"px-3 py-4 text-sm text-gray-500",children:e.jsx("div",{className:"flex flex-wrap gap-1 max-w-sm",children:n.units.length>0?n.units.map(d=>e.jsx("span",{className:"inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10",children:d.name},d.id)):e.jsx("span",{className:"text-xs text-gray-400",children:"Not assigned"})})}),e.jsx("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:e.jsxs("a",{href:"#",className:"text-orange-600 hover:text-orange-900",children:["Edit",e.jsxs("span",{className:"sr-only",children:[", ",n.name]})]})})]},n.id))})]})})})})})]})]})}const fe=s.lazy(()=>_(()=>import("./UnitsTable-DRMpi2L9.js"),__vite__mapDeps([0,1,2,3,4,5]))),ge=s.lazy(()=>_(()=>import("./UnitCard-C05d7ARk.js"),__vite__mapDeps([6,1,2,3,4,5]))),ye=s.lazy(()=>_(()=>import("./UnitModal-Ba5EOyxI.js"),__vite__mapDeps([7,1,2,3,4,8,9,10,11,12,13,14]))),je=s.lazy(()=>_(()=>import("./EditUnitModal-CLqKFMES.js"),__vite__mapDeps([15,1,2,3,4,9,10,11,12,13,14]))),be=s.lazy(()=>_(()=>import("./DeleteUnitModal-RZPdEUsf.js"),__vite__mapDeps([16,1,2,3,4,14]))),ve=()=>{const[r,a]=s.useState(!1),[i,t]=s.useState(!1),[p,m]=s.useState(!1),[g,x]=s.useState(!1),[c,n]=s.useState(null),{data:d,totalCount:k,isLoading:F,error:N,mutate:h,currentPage:y,setCurrentPage:j,pageCount:L,pageSize:O,searchTerm:A,setSearchTerm:E,activeSearchTerm:b,handleSearch:P,clearSearch:f}=V({tableName:"units",selectQuery:`
      id, name, sqm, property_id,
      unit_type_id,
      leasing_type_id,
      unit_category_id,
      unit_category_2_id,
      unit_category_3_id,
      properties (property_name, number_of_units, total_sqm), 
      unit_types (unit_type)
    `,searchColumn:"name",initialPageSize:10}),T=()=>{a(!1),h()},C=o=>{n(o),t(!0)},M=()=>{t(!1),n(null),h()},w=o=>{n(o),m(!0)},l=async()=>{if(c){x(!0);try{const{error:o}=await S.from("units").delete().eq("id",c.id);if(o)throw o;d.length===1&&y>1?j(y-1):h()}catch(o){console.error("Failed to delete unit:",o)}finally{x(!1),m(!1),n(null)}}},U=o=>e.jsx(s.Suspense,{fallback:e.jsx(R,{}),children:e.jsx(fe,{units:o,onEdit:C,onDelete:w})}),u=o=>e.jsx(s.Suspense,{fallback:e.jsx(R,{}),children:e.jsx("div",{className:"space-y-4 p-4",children:o.map(v=>e.jsx(ge,{unit:v,onEdit:()=>C(v),onDelete:()=>w(v)},v.id))})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6 w-full mx-auto p-4 pt-15 md:p-6 max-w-[95rem] xl:px-12",children:[e.jsx(K,{title:"Manage Units",description:"View, edit, and manage all property units.",buttonText:"Add New Units",onButtonClick:()=>a(!0)}),e.jsx(Y,{searchTerm:A,setSearchTerm:E,activeSearchTerm:b,onSearch:P,onClear:f,placeholder:"Search by unit name..."}),e.jsx(ee,{isLoading:F,error:N,data:d,totalCount:k,pageCount:L,currentPage:y,onPageChange:j,pageSize:O,activeSearchTerm:b,renderTable:U,renderCards:u,emptyStateTitle:"No Units Found",emptyStateDescription:'Click "Add New Units" to get started.'})]}),e.jsxs(s.Suspense,{fallback:null,children:[e.jsx(ye,{isOpen:r,onClose:()=>a(!1),onSuccess:T}),c&&e.jsxs(e.Fragment,{children:[e.jsx(je,{isOpen:i,onClose:()=>t(!1),onSuccess:M,unit:c}),e.jsx(be,{isOpen:p,onClose:()=>m(!1),onConfirm:l,isDeleting:g,itemName:c.name})]})]}),e.jsx(he,{})]})},Ee=Object.freeze(Object.defineProperty({__proto__:null,default:ve},Symbol.toStringTag,{value:"Module"}));export{ce as F,Ee as U};
