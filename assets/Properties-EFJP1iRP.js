const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PropertiesTable-Bd6t6VNJ.js","assets/index-BU3CQqfv.js","assets/vendor-D0onPmP6.js","assets/ui-CRpVhgKF.js","assets/index-CZ64v80T.css","assets/PropertiesTable-h0EPuWW_.css","assets/PropertyCard-DCaLy2Iy.js","assets/TrashIcon-Dlbufv-M.js","assets/AddPropertyModal-C_-VeOR3.js","assets/ImageUploader-qKRF4TSo.js","assets/react-paginate-AX4tIbqh.js","assets/ImageUploader-BD8MpcyB.css","assets/index-BHaIYkby.js","assets/Stepper-FuDBMjN3.js","assets/EditPropertyModal-F8uMPCkC.js","assets/DeletePropertyModal-DgBgGguo.js","assets/ExclamationTriangleIcon-BI5VgTw-.js"])))=>i.map(i=>d[i]);
import{b as t,_ as n}from"./vendor-D0onPmP6.js";import{u as q,j as e,g as b,s as j}from"./index-BU3CQqfv.js";import{u as B}from"./useSupabaseQuery-DlxLBHLb.js";import{P as F,S as $,D as H}from"./DataTable-BdfFL_S3.js";import"./ui-CRpVhgKF.js";import"./react-paginate-AX4tIbqh.js";const Q=t.lazy(()=>n(()=>import("./PropertiesTable-Bd6t6VNJ.js"),__vite__mapDeps([0,1,2,3,4,5]))),Y=t.lazy(()=>n(()=>import("./PropertyCard-DCaLy2Iy.js"),__vite__mapDeps([6,1,2,3,4,7]))),U=t.lazy(()=>n(()=>import("./AddPropertyModal-C_-VeOR3.js"),__vite__mapDeps([8,1,2,3,4,9,10,11,12,13]))),G=t.lazy(()=>n(()=>import("./EditPropertyModal-F8uMPCkC.js"),__vite__mapDeps([14,1,2,3,4,9,10,11,12,13]))),J=t.lazy(()=>n(()=>import("./DeletePropertyModal-DgBgGguo.js"),__vite__mapDeps([15,1,2,3,4,16]))),E=r=>{if(!r||!r.address_street)return"N/A";let a=[];switch(r.address_country_iso){case"PH":a=[r.address_street,r.address_barangay,`${r.address_city_municipality}, ${r.address_province}`,r.address_zip_code,r.address_country];break;default:a=[r.address_street,r.address_city_municipality,r.address_province,r.address_zip_code,r.address_country];break}return a.filter(Boolean).join(", ")||"N/A"},re=()=>{const[r,a]=t.useState(!1),[f,c]=t.useState(!1),[A,p]=t.useState(!1),[D,y]=t.useState(!1),[o,i]=t.useState(null),h=q(s=>s.userProfile),{data:g,totalCount:C,isLoading:v,error:O,mutate:_,currentPage:l,setCurrentPage:u,pageCount:T,pageSize:M,searchTerm:z,setSearchTerm:I,activeSearchTerm:m,handleSearch:N,clearSearch:P}=B({tableName:"properties",selectQuery:"id, property_name, number_of_units, total_sqm, business_licenses, certificates_of_registration, created_by, address_street, address_zip_code, address_region, address_province, address_city_municipality, address_barangay, address_country_iso, address_country, overall_sqm",searchColumn:"property_name",initialPageSize:5}),w=()=>{a(!1),_(),(l!==1||m)&&(u(1),P(!1))},S=s=>{i(s),c(!0)},L=()=>{c(!1),i(null),_()},x=s=>{i(s),p(!0)},k=async()=>{if(o){y(!0);try{const s=[...o.business_licenses?.files||[],...o.certificates_of_registration?.files||[]].map(V=>V.path).filter(Boolean);s.length>0&&await j.storage.from("property-documents").remove(s);const{error:d}=await j.from("properties").delete().eq("id",o.id);if(d)throw d;g.length===1&&l>1?u(l-1):_()}catch(s){console.error("Failed to delete property:",s)}finally{y(!1),p(!1),i(null)}}},R=s=>h?s.created_by===h.id?"You":`User ${s.created_by.substring(0,8)}...`:"Loading...";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6 w-full mx-auto p-4 pt-15 md:p-6 max-w-[95rem] xl:px-12",children:[e.jsx(F,{title:"Manage Properties",description:"Add, edit, and manage your properties here.",buttonText:"Add New Property",onButtonClick:()=>a(!0)}),e.jsx($,{searchTerm:z,setSearchTerm:I,activeSearchTerm:m,onSearch:N,onClear:P,placeholder:"Search by property name..."}),e.jsx(H,{isLoading:v,error:O,data:g,totalCount:C,pageCount:T,currentPage:l,onPageChange:u,pageSize:M,activeSearchTerm:m,renderTable:s=>e.jsx(t.Suspense,{fallback:e.jsx(b,{}),children:e.jsx(Q,{properties:s,onEdit:S,onDelete:x,formatAddress:E,getCreatorDisplay:R})}),renderCards:s=>e.jsx(t.Suspense,{fallback:e.jsx(b,{}),children:e.jsx("div",{className:"space-y-4 p-4",children:s.map(d=>e.jsx(Y,{property:d,onEdit:()=>S(d),onDelete:()=>x(d),formatAddress:E},d.id))})}),emptyStateTitle:"No Properties Yet",emptyStateDescription:'Click "Add New Property" to get started.'})]}),e.jsxs(t.Suspense,{fallback:null,children:[e.jsx(U,{isOpen:r,onClose:()=>a(!1),onSuccess:w}),o&&e.jsxs(e.Fragment,{children:[e.jsx(G,{isOpen:f,onClose:()=>c(!1),onSuccess:L,property:o}),e.jsx(J,{isOpen:A,onClose:()=>p(!1),onConfirm:k,isDeleting:D,itemName:o.property_name})]})]})]})};export{re as default};
