const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PropertiesTable-DCFBaaQT.js","assets/index-Bu7T6usM.js","assets/vendor-CltuolhD.js","assets/ui-BZV_7ZZi.js","assets/index-5ea9rJB0.css","assets/PropertiesTable-h0EPuWW_.css","assets/PropertyCard-DqNEMSF6.js","assets/TrashIcon-CtbRN9aw.js","assets/AddPropertyModal-CQ_nXOOQ.js","assets/index-1B4MFokv.js","assets/react-paginate-vCY7IKIj.js","assets/index-BD8MpcyB.css","assets/Stepper-OB66GHAN.js","assets/EditPropertyModal-DwhGaxRC.js","assets/DeletePropertyModal-DyRiYTss.js","assets/ExclamationTriangleIcon-CY9RlToI.js"])))=>i.map(i=>d[i]);
import{b as t,_ as n}from"./vendor-CltuolhD.js";import{u as q,j as e,L as x,s as b}from"./index-Bu7T6usM.js";import{u as B}from"./react-paginate-vCY7IKIj.js";import{P as F,S as H,D as Q}from"./DataTable-CR7nGn7h.js";import"./ui-BZV_7ZZi.js";const Y=t.lazy(()=>n(()=>import("./PropertiesTable-DCFBaaQT.js"),__vite__mapDeps([0,1,2,3,4,5]))),U=t.lazy(()=>n(()=>import("./PropertyCard-DqNEMSF6.js"),__vite__mapDeps([6,1,2,3,4,7]))),$=t.lazy(()=>n(()=>import("./AddPropertyModal-CQ_nXOOQ.js"),__vite__mapDeps([8,1,2,3,4,9,10,11,12]))),G=t.lazy(()=>n(()=>import("./EditPropertyModal-DwhGaxRC.js"),__vite__mapDeps([13,1,2,3,4,9,10,11,12]))),J=t.lazy(()=>n(()=>import("./DeletePropertyModal-DyRiYTss.js"),__vite__mapDeps([14,1,2,3,4,15]))),j=r=>(r.address_country_iso==="PH"?[r.address_street,r.address_barangay,r.address_city_municipality,r.address_province,r.address_zip_code,r.address_country]:[r.address_street,r.address_state,r.address_zip_code,r.address_country]).filter(Boolean).join(", ")||"N/A",se=()=>{const[r,d]=t.useState(!1),[E,c]=t.useState(!1),[D,p]=t.useState(!1),[C,y]=t.useState(!1),[a,i]=t.useState(null),f=q(s=>s.userProfile),{data:P,totalCount:A,isLoading:O,error:T,mutate:_,currentPage:l,setCurrentPage:u,pageCount:v,pageSize:M,searchTerm:z,setSearchTerm:I,activeSearchTerm:m,handleSearch:L,clearSearch:h}=B({tableName:"properties",selectQuery:"id, property_name, number_of_units, total_sqm, business_licenses, certificates_of_registration, created_by, address_country, address_country_iso, address_street, address_zip_code, address_state, address_state_iso, address_region, address_province, address_city_municipality, address_barangay, overall_sqm",searchColumn:"property_name",initialPageSize:5}),N=()=>{d(!1),_(),(l!==1||m)&&(u(1),h(!1))},g=s=>{i(s),c(!0)},w=()=>{c(!1),i(null),_()},S=s=>{i(s),p(!0)},R=async()=>{if(a){y(!0);try{const s=[...a.business_licenses?.files||[],...a.certificates_of_registration?.files||[]].map(V=>V.path).filter(Boolean);s.length>0&&await b.storage.from("property-documents").remove(s);const{error:o}=await b.from("properties").delete().eq("id",a.id);if(o)throw o;P.length===1&&l>1?u(l-1):_()}catch(s){console.error("Failed to delete property:",s)}finally{y(!1),p(!1),i(null)}}},k=s=>f?s.created_by===f.id?"You":`User ${s.created_by.substring(0,8)}...`:"Loading...";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6 w-full mx-auto p-4 pt-15 md:p-6 max-w-[95rem] xl:px-12",children:[e.jsx(F,{title:"Manage Properties",description:"Add, edit, and manage your properties here.",buttonText:"Add New Property",onButtonClick:()=>d(!0)}),e.jsx(H,{searchTerm:z,setSearchTerm:I,activeSearchTerm:m,onSearch:L,onClear:h,placeholder:"Search by property name..."}),e.jsx(Q,{isLoading:O,error:T,data:P,totalCount:A,pageCount:v,currentPage:l,onPageChange:u,pageSize:M,activeSearchTerm:m,renderTable:s=>e.jsx(t.Suspense,{fallback:e.jsx(x,{}),children:e.jsx(Y,{properties:s,onEdit:g,onDelete:S,formatAddress:j,getCreatorDisplay:k})}),renderCards:s=>e.jsx(t.Suspense,{fallback:e.jsx(x,{}),children:e.jsx("div",{className:"space-y-4 p-4",children:s.map(o=>e.jsx(U,{property:o,onEdit:()=>g(o),onDelete:()=>S(o),formatAddress:j},o.id))})}),emptyStateTitle:"No Properties Yet",emptyStateDescription:'Click "Add New Property" to get started.'})]}),e.jsxs(t.Suspense,{fallback:null,children:[e.jsx($,{isOpen:r,onClose:()=>d(!1),onSuccess:N}),a&&e.jsxs(e.Fragment,{children:[e.jsx(G,{isOpen:E,onClose:()=>c(!1),onSuccess:w,property:a}),e.jsx(J,{isOpen:D,onClose:()=>p(!1),onConfirm:R,isDeleting:C,itemName:a.property_name})]})]})]})};export{se as default};
